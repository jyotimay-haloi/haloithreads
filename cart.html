<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cart | Haloi Threads</title>
    <style>
        /* =========================================
           1. CORE DESIGN SYSTEM
           ========================================= */
        :root {
            --ease-luxury: cubic-bezier(0.65, 0, 0.35, 1);
            --bg-dark: #080808;
            --accent-muga: #9e8f6b;
            --text-main: #fff;
            --text-secondary: #888;
            --border-light: rgba(255,255,255,0.08);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { margin: 0; background: var(--bg-dark); color: var(--text-main); font-family: 'Helvetica Neue', sans-serif; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
        button { font-family: inherit; }

        /* =========================================
           2. CART OVERLAY & DRAWER
           ========================================= */
        #cart-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 200;
            opacity: 0; visibility: hidden;
            transition: opacity 0.6s var(--ease-luxury), visibility 0.6s;
        }
        #cart-overlay.active { opacity: 1; visibility: visible; }

        .cart-loom-lines { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        .cart-line {
            position: absolute; top: -100%; width: 1px; height: 100%;
            background: rgba(255, 255, 255, 0.05);
            animation: loomPass 3s infinite linear;
        }
        .cart-line:nth-child(1) { left: 10%; animation-duration: 4s; }
        .cart-line:nth-child(2) { left: 30%; animation-duration: 5s; }
        .cart-line:nth-child(3) { left: 70%; animation-duration: 4.5s; }
        .cart-line:nth-child(4) { left: 90%; animation-duration: 6s; }

        @keyframes loomPass { 0% { top: -100%; } 100% { top: 100%; } }

        #cart-drawer {
            position: fixed; top: 0; right: 0; 
            width: 500px; /* Desktop default */
            max-width: 100%; 
            height: 100%;
            background: #0a0a0a; 
            border-left: 1px solid var(--border-light);
            z-index: 201;
            transform: translateX(100%);
            transition: transform 0.5s var(--ease-luxury);
            display: flex; flex-direction: column;
            box-shadow: -10px 0 50px rgba(0,0,0,0.8);
        }
        #cart-drawer.active { transform: translateX(0); }

        /* =========================================
           3. CART INTERIOR LAYOUT
           ========================================= */
        .cart-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--border-light);
            display: flex; justify-content: space-between; align-items: center;
            background: #0a0a0a; z-index: 10;
        }
        .cart-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.2em; color: var(--accent-muga); }
        .close-cart { cursor: pointer; color: var(--text-main); font-size: 1.5rem; padding: 10px; line-height: 1; }

        .cart-items-container {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            scrollbar-width: thin;
            position: relative;
        }

        .empty-cart-msg {
            text-align: center; margin-top: 100px; color: var(--text-secondary);
            font-size: 0.9rem; letter-spacing: 0.05em; opacity: 0.6; padding: 0 20px;
        }

        /* =========================================
           4. CART ITEM CARD
           ========================================= */
        .cart-item {
            display: flex; gap: 20px;
            padding: 30px;
            border-bottom: 1px solid var(--border-light);
            position: relative;
            background: transparent;
            overflow: hidden; 
        }
        
        .item-image {
            width: 90px; height: 120px;
            background-color: #151515;
            flex-shrink: 0;
            z-index: 5;
            position: relative;
        }
        .item-image img { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        
        .item-details { flex: 1; display: flex; flex-direction: column; justify-content: space-between; padding: 2px 0; z-index: 5; }
        
        .item-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .item-name { font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em; color: #fff; margin: 0; line-height: 1.2; }
        .item-variant { font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px; display: block; }
        
        .item-remove { 
            font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; 
            color: #555; cursor: pointer; border-bottom: 1px solid transparent; 
            padding: 5px; margin-right: -5px; /* Increase hit area */
        }

        .item-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        .item-price { font-size: 0.95rem; color: var(--accent-muga); letter-spacing: 0.05em; font-weight: 500; }

        /* =========================================
           5. QUANTITY SELECTOR
           ========================================= */
        .qty-wrapper {
            display: flex; align-items: center; 
            border: 1px solid rgba(255,255,255,0.2);
            background: #000;
        }
        
        .qty-btn {
            width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: #fff; user-select: none;
            font-size: 1.4rem;
            position: relative;
            /* No hover on touch devices to prevent stickiness */
        }
        @media (hover: hover) {
            .qty-btn:hover { background: rgba(255,255,255,0.1); }
        }
        .qty-btn:active { background: rgba(255,255,255,0.2); }

        .qty-val { 
            width: 40px; 
            text-align: center; 
            font-size: 1.1rem;
            font-weight: 500;
            color: #fff;
        }

        /* =========================================
           6. TOTALS & FOOTER
           ========================================= */
        .cart-footer {
            padding: 25px 30px;
            background: #0c0c0c;
            border-top: 1px solid var(--border-light);
            z-index: 10;
        }
        .cart-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 0.85rem; color: var(--text-secondary); }
        .cart-row.total { color: #fff; font-size: 1.1rem; font-weight: 500; margin-top: 20px; margin-bottom: 25px; padding-top: 20px; border-top: 1px solid var(--border-light); }
        
        .btn-checkout {
            width: 100%; padding: 20px;
            background: var(--accent-muga); border: none;
            color: #000; text-transform: uppercase; letter-spacing: 0.2em; font-weight: 700; font-size: 0.85rem;
            cursor: pointer;
        }
        
        /* =========================================
           7. ðŸ’¥ ANIMATION
           ========================================= */
        .ripple-wave {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, rgba(158, 143, 107, 0.1) 60%, transparent 80%);
            transform: scale(0);
            pointer-events: none;
            z-index: 1; 
            animation: rippleExpand 1s ease-out forwards;
        }

        @keyframes rippleExpand {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(15); opacity: 0; }
        }

        /* =========================================
           8. RESPONSIVE / MOBILE STYLES
           ========================================= */
        
        /* Product Demo Page */
        .product-demo { 
            padding: 80px 40px; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 40px; 
        }
        .product-card { width: 300px; text-align: left; }
        .product-img-box {
            background: #151515; height: 380px; width: 100%;
            display: flex; align-items: center; justify-content: center; color: #333; font-size: 0.8rem; letter-spacing: 1px;
        }
        .btn-add-demo { margin-top: 15px; padding: 15px 30px; background: transparent; border: 1px solid #fff; color: #fff; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; font-size: 0.8rem; width: 100%; }

        /* NAVBAR */
        nav { padding: 25px 50px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; background: #080808; z-index: 100; }
        .nav-logo { color:#fff; text-decoration: none; font-weight: bold; letter-spacing: 3px; font-size: 1.1rem; }
        .cart-badge { color: var(--accent-muga); margin-left: 5px; font-weight: bold; }

        /* MOBILE BREAKPOINT */
        @media (max-width: 768px) {
            nav { padding: 20px; }
            .nav-logo { font-size: 0.9rem; letter-spacing: 1px; }
            
            #cart-drawer { width: 100%; /* Full Width on Mobile */ }
            
            .cart-item { padding: 20px; gap: 15px; }
            .item-image { width: 80px; height: 110px; }
            .item-name { font-size: 0.9rem; }
            
            /* Make quantity buttons slightly smaller but still tappable */
            .qty-btn { width: 40px; height: 40px; font-size: 1.2rem; }
            .qty-val { width: 30px; font-size: 1rem; }
            
            .product-demo { padding: 40px 20px; }
            .product-card { width: 100%; /* Full width cards */ margin-bottom: 20px; }
            .product-img-box { height: 300px; /* Reduced height */ }
        }

    </style>
</head>
<body>

    <!-- DOM -->
    <div id="cart-overlay" onclick="HaloiCart.close()">
        <div class="cart-loom-lines">
            <div class="cart-line"></div><div class="cart-line"></div><div class="cart-line"></div><div class="cart-line"></div>
        </div>
    </div>

    <div id="cart-drawer">
        <div class="cart-header">
            <span class="cart-title">Your Selection</span>
            <div class="close-cart" onclick="HaloiCart.close()">âœ•</div>
        </div>

        <div id="cart-items-wrapper" class="cart-items-container">
            <!-- Items injected via JS -->
        </div>

        <div class="cart-footer">
            <div class="cart-row">
                <span>Subtotal</span>
                <span id="cart-subtotal">â‚¹0</span>
            </div>
            <div class="cart-row">
                <span>Shipping</span>
                <span>Calculated at checkout</span>
            </div>
            <div class="cart-row total">
                <span>Total</span>
                <span id="cart-total">â‚¹0</span>
            </div>
            <button id="btn-checkout" class="btn-checkout" onclick="HaloiCart.checkout()">Proceed to Checkout</button>
        </div>
    </div>

    <!-- NAV -->
    <nav>
        <div class="nav-container">
            <a href="#" class="nav-logo">HALOI THREADS</a>
        </div>
        <div class="nav-item" style="font-size: 0.8rem; cursor: pointer; text-transform: uppercase; letter-spacing: 0.15em;" onclick="HaloiCart.open()">
            Cart <span id="nav-cart-count" class="cart-badge">(0)</span>
        </div>
    </nav>

    <!-- PRODUCT DEMO -->
    <div class="product-demo">
        <h2 style="width: 100%; font-weight: 300; letter-spacing: 0.3em; color: var(--accent-muga); margin-bottom: 40px; font-size: 0.9rem; text-align: center;">LATEST COLLECTION</h2>
        
        <div class="product-card">
            <div class="product-img-box">IMAGE A</div>
            <h3 style="margin: 20px 0 5px; font-size: 1.1rem; letter-spacing: 1px; font-weight: 400;">Eri Silk Scarf</h3>
            <p style="margin: 0; color: #888; font-size: 0.95rem;">â‚¹4,500</p>
            <button class="btn-add-demo" onclick="HaloiCart.add({id: 'p1', name: 'Eri Silk Scarf', price: 4500, image: '', variant: 'Natural'})">Add to Cart</button>
        </div>

        <div class="product-card">
            <div class="product-img-box" style="background: #1a1a1a;">IMAGE B</div>
            <h3 style="margin: 20px 0 5px; font-size: 1.1rem; letter-spacing: 1px; font-weight: 400;">Muga Gold Vest</h3>
            <p style="margin: 0; color: #888; font-size: 0.95rem;">â‚¹12,500</p>
            <button class="btn-add-demo" onclick="HaloiCart.add({id: 'p2', name: 'Muga Gold Vest', price: 12500, image: '', variant: 'Size M'})">Add to Cart</button>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        const HaloiCart = {
            key: 'haloi_cart_storage',
            items: [],

            init() {
                const stored = localStorage.getItem(this.key);
                if (stored) {
                    try { this.items = JSON.parse(stored); } 
                    catch (e) { this.items = []; }
                }
                this.render();
            },

            save() {
                localStorage.setItem(this.key, JSON.stringify(this.items));
                this.updateGlobalTotals();
            },

            add(product) {
                const existing = this.items.find(i => i.id === product.id);
                if (existing) {
                    existing.qty++;
                    this.save();
                    this.render(); 
                } else {
                    this.items.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        variant: product.variant || 'Standard',
                        qty: 1
                    });
                    this.save();
                    this.render();
                }
                this.open();
            },

            updateQty(id, delta, sourceElement) {
                const item = this.items.find(i => i.id === id);
                if (!item) return;

                const newQty = item.qty + delta;
                if (newQty < 1) return;

                item.qty = newQty;
                this.save(); 

                const qtyEl = document.getElementById(`qty-val-${id}`);
                if (qtyEl) qtyEl.innerText = newQty;

                this.recalculateCartTotals();

                if (delta > 0 && sourceElement) {
                    this.triggerRipple(sourceElement);
                }
            },

            remove(id) {
                this.items = this.items.filter(i => i.id !== id);
                this.save();
                this.render();
            },

            checkout() {
                if (this.items.length === 0) return;
                alert("Redirecting to Checkout...");
                this.items = [];
                this.save();
                this.render();
                this.close();
            },

            open() {
                document.getElementById('cart-overlay').classList.add('active');
                setTimeout(() => {
                    document.getElementById('cart-drawer').classList.add('active');
                }, 10);
            },

            close() {
                document.getElementById('cart-drawer').classList.remove('active');
                setTimeout(() => {
                    document.getElementById('cart-overlay').classList.remove('active');
                }, 400);
            },

            triggerRipple(btnElement) {
                const card = btnElement.closest('.cart-item');
                if (!card) return;

                const ripple = document.createElement('div');
                ripple.classList.add('ripple-wave');
                
                const cardRect = card.getBoundingClientRect();
                const btnRect = btnElement.getBoundingClientRect();
                
                const top = (btnRect.top - cardRect.top) + (btnRect.height / 2);
                const left = (btnRect.left - cardRect.left) + (btnRect.width / 2);

                ripple.style.top = `${top}px`;
                ripple.style.left = `${left}px`;
                ripple.style.width = '20px'; 
                ripple.style.height = '20px';
                ripple.style.marginTop = '-10px'; 
                ripple.style.marginLeft = '-10px';

                card.appendChild(ripple);
                setTimeout(() => { ripple.remove(); }, 1000);
            },

            recalculateCartTotals() {
                let totalCost = 0;
                this.items.forEach(item => totalCost += (item.price * item.qty));
                
                const fmtTotal = new Intl.NumberFormat('en-IN').format(totalCost);
                const subEl = document.getElementById('cart-subtotal');
                const totEl = document.getElementById('cart-total');
                
                if(subEl) subEl.innerText = `â‚¹${fmtTotal}`;
                if(totEl) totEl.innerText = `â‚¹${fmtTotal}`;
            },

            updateGlobalTotals() {
                const totalQty = this.items.reduce((sum, item) => sum + item.qty, 0);
                const navEl = document.getElementById('nav-cart-count');
                if(navEl) navEl.innerText = `(${totalQty})`;
            },

            render() {
                const container = document.getElementById('cart-items-wrapper');
                const checkoutBtn = document.getElementById('btn-checkout');

                this.updateGlobalTotals();

                if (this.items.length === 0) {
                    container.innerHTML = `<div class="empty-cart-msg">Your selection is currently empty.</div>`;
                    this.recalculateCartTotals();
                    checkoutBtn.disabled = true;
                    checkoutBtn.innerText = "Cart Empty";
                    return;
                }

                checkoutBtn.disabled = false;
                checkoutBtn.innerText = "Proceed to Checkout";

                let html = '';
                
                this.items.forEach(item => {
                    const fmtPrice = new Intl.NumberFormat('en-IN').format(item.price);
                    html += `
                    <div class="cart-item" id="item-${item.id}">
                        <div class="item-image">
                            ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ''}
                        </div>
                        <div class="item-details">
                            <div class="item-top">
                                <div>
                                    <h4 class="item-name">${item.name}</h4>
                                    <span class="item-variant">${item.variant}</span>
                                </div>
                                <div class="item-remove" onclick="HaloiCart.remove('${item.id}')">Remove</div>
                            </div>
                            
                            <div class="item-bottom">
                                <div class="qty-wrapper">
                                    <div class="qty-btn" onclick="HaloiCart.updateQty('${item.id}', -1, this)">âˆ’</div>
                                    <div class="qty-val" id="qty-val-${item.id}">${item.qty}</div>
                                    <div class="qty-btn" onclick="HaloiCart.updateQty('${item.id}', 1, this)">+</div>
                                </div>
                                <div class="item-price">â‚¹${fmtPrice}</div>
                            </div>
                        </div>
                    </div>`;
                });
                
                container.innerHTML = html;
                this.recalculateCartTotals();
            }
        };

        // Initialize Cart on Load
        document.addEventListener('DOMContentLoaded', () => {
            HaloiCart.init();
        });
    </script>
</body>
</html>